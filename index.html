<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>毛玻璃音乐播放器 · Demo (v6)</title>
<meta name="theme-color" content="#0a0a0a" />
<style>
:root{
  --brandA:#7C8CFF; --brandB:#FF83C6; --glass: rgba(255,255,255,.28);
  --border: rgba(255,255,255,.55);
  --muted:#6b7280; --ink:#111827; --radius:20px; --t:.28s cubic-bezier(.22,.61,.36,1);
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Segoe UI,Roboto,Arial,sans-serif; background:
 radial-gradient(1200px 800px at 20% -10%, #e8ecff 0%, transparent 55%),
 radial-gradient(1200px 900px at 120% 20%, #ffe7f6 0%, transparent 60%),
 linear-gradient(135deg, #E0E9FF 0%, #FDE2FF 100%); color:var(--ink);}
.wrap{width:min(1080px,96vw); padding:env(safe-area-inset-top,16px) 16px 90px;}
.blobs{position:fixed; inset:0; pointer-events:none; z-index:0; filter: blur(22px) saturate(130%)}
.blob{position:absolute; border-radius:999px; background:conic-gradient(from 180deg, rgba(124,140,255,.75), rgba(255,131,198,.75)); mix-blend-mode:screen; opacity:.55; animation:floatY 18s ease-in-out infinite}
.blob.b1{width:42vmin;height:42vmin;left:-6vmin;top:6vmin}
.blob.b2{width:56vmin;height:56vmin;right:-10vmin;top:20vmin}
.blob.b3{width:48vmin;height:48vmin;left:30vmin;bottom:-12vmin}
@keyframes floatY{0%,100%{transform:translateY(0)}50%{transform:translateY(-18px)}}

.header{ text-align:center; margin:18px 0 }
.title{ font-weight:900; font-size:clamp(28px,6.5vw,44px); background:linear-gradient(90deg,var(--brandA),var(--brandB)); -webkit-background-clip:text; color:transparent}
.sub{ color:var(--muted); max-width:760px; margin:6px auto 0; font-size:15px }

.statusbar{ margin:18px auto; width:min(960px,100%); border-radius:18px; padding:12px; background:var(--glass); border:1px solid var(--border); box-shadow:0 14px 60px rgba(16,24,40,.12); backdrop-filter: blur(14px) saturate(140%) }
.pill{ display:inline-flex; gap:10px; padding:10px 14px; border-radius:999px; background:rgba(255,255,255,.5); font-weight:700 }
.subnote{ margin-top:6px; color:var(--muted); display:flex; gap:8px; align-items:center; justify-content:center; font-size:13px }

.visit-wrap{ display:flex; justify-content:center; margin:12px 0 }
.visit{ text-decoration:none; width:min(960px,100%); display:flex; justify-content:center; align-items:center; padding:14px 18px; border-radius:18px; font-weight:800; background:linear-gradient(90deg,var(--brandA),var(--brandB)); color:#fff; box-shadow:0 12px 28px rgba(124,140,255,.36) }

.grid{ display:grid; gap:18px; grid-template-columns:1fr; }
@media(min-width:860px){ .grid{ grid-template-columns:repeat(3,1fr) } }
.card{ background: rgba(255,255,255,.40); border:1px solid var(--border); border-radius:18px; padding:0; overflow:hidden; box-shadow:0 14px 60px rgba(16,24,40,.08); backdrop-filter: blur(14px); }
.card-head{ display:flex; justify-content:space-between; align-items:center; padding:12px; background:linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.35)) }
.card-title{ font-weight:800 }
.unlock{ background:linear-gradient(90deg,var(--brandA),var(--brandB)); color:#fff; border:0; padding:9px 12px; border-radius:12px; font-weight:800; cursor:pointer }

.pw{ display:none; padding:12px; border-top:1px solid rgba(0,0,0,.03) }
.input{ flex:1; padding:0 12px; height:42px; border-radius:12px; border:1.5px solid rgba(0,0,0,.06) }
.ok{ background:linear-gradient(90deg,#30D158,#0FB56A); color:#fff; border:0; padding:9px 12px; border-radius:12px; cursor:pointer }
.msg{ min-height:20px; font-size:13px; margin-top:8px }

.content{ max-height:0; overflow:hidden; transition:max-height .45s ease, padding .45s ease }
.content-inner{ padding:12px; color:#374151 }

.footer{ text-align:center; color:var(--muted); margin-top:22px }

/* modal & gate */
.overlay{ position:fixed; inset:0; z-index:30; display:flex; align-items:center; justify-content:center; padding:20px; background:rgba(10,10,10,.35); backdrop-filter:blur(12px) }
.modal{ width:min(860px,96vw); border-radius:28px; background:rgba(255,255,255,.36); border:1px solid var(--border); box-shadow:0 24px 90px rgba(16,24,40,.30); padding:20px; backdrop-filter:blur(24px) }
.md-title{ text-align:center; font-size:clamp(22px,5.6vw,32px); font-weight:900; margin:0 0 12px }
.sect h4{ margin:.2em 0 .4em; font-size:18px; color:#5C7CFF; font-weight:900 }
.sect p{ margin:.2em 0; color:#4b5563; line-height:1.9 }

.md-actions{ display:flex; justify-content:center; padding-top:6px }
.md-okay{ border:0; padding:14px 20px; border-radius:28px; font-weight:900; font-size:16px; background:linear-gradient(90deg,var(--brandA),var(--brandB)); color:#fff; cursor:pointer }
.md-okay[disabled]{ opacity:.48; cursor:not-allowed; filter:grayscale(.05) }

/* gate */
.gate{ position:fixed; inset:0; z-index:25; display:flex; align-items:center; justify-content:center; padding:20px; gap:20px; background:linear-gradient(135deg,#E6ECFF,#FFE6F6) }
.gate-card{ width:min(720px,94vw); border-radius:26px; padding:22px; text-align:center; background:rgba(255,255,255,.62); border:1px solid var(--border); box-shadow:0 24px 80px rgba(16,24,40,.12) }
.gate h2{ margin:6px 0 10px; font-size:clamp(22px,6vw,34px); font-weight:900; background:linear-gradient(90deg,var(--brandA),var(--brandB)); -webkit-background-clip:text; color:transparent }

/* player bar */
.player{
  position:fixed; left:50%; transform:translateX(-50%); bottom:18px; z-index:40;
  width:min(960px,96%); border-radius:20px; padding:10px; display:flex; gap:12px; align-items:center;
  background:rgba(255,255,255,.26); border:1px solid rgba(255,255,255,.5); box-shadow:0 18px 60px rgba(16,24,40,.12); backdrop-filter:blur(12px) saturate(140%);
  transition: transform .28s ease, opacity .28s ease;
}
.player.hidden{ transform: translateX(-50%) translateY(20px); opacity:0; pointer-events:none }
.cover{ width:56px; height:56px; border-radius:8px; overflow:hidden; flex:0 0 56px; background:#eee }
.meta{ flex:1; min-width:0 }
.track{ font-weight:800; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.artist{ font-size:13px; color:var(--muted); margin-top:4px }
.controls{ display:flex; gap:8px; align-items:center; margin-left:12px }
.btn{ width:44px; height:44px; border-radius:12px; border:0; background:rgba(255,255,255,.9); cursor:pointer; display:inline-flex; align-items:center; justify-content:center; font-weight:800 }
.progress{ width:100%; display:flex; align-items:center; gap:8px; margin-top:8px }
.progress input[type="range"]{ width:100% }

/* time small */
.time{ font-size:12px; color:var(--muted); min-width:44px; text-align:center }

/* responsive */
@media(max-width:560px){
  .track{ font-size:13px }
  .cover{ width:48px;height:48px;flex:0 0 48px }
  .player{ padding:8px; border-radius:14px }
}
</style>
</head>
<body>
<div class="blobs" aria-hidden="true"><div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div></div>

<!-- Modal -->
<div class="overlay" id="modal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="md-title">
    <h1 id="md-title" class="md-title">欢迎提示</h1>
    <section class="sect">
      <h4>重要通知</h4>
      <p>欢迎访问演示页面。为了提供更好的试听体验，页面将在确认后播放示例音乐（可替换）。</p>
    </section>
    <section class="sect">
      <h4>使用说明</h4>
      <p>按钮倒计时完成后可点击「我明白了」。点击后进入预览页面，再点击“进入主页面”加载并播放音乐。</p>
    </section>
    <div class="md-actions">
      <button id="md-continue" class="md-okay" disabled>我明白了 (5)</button>
    </div>
  </div>
</div>

<!-- Gate -->
<section class="gate" id="gate" hidden>
  <div class="gate-card">
    <h2>预览界面 · 二次确认</h2>
    <p>点击下方按钮进入主页面并开始播放音乐。</p>
    <div style="margin-top:14px">
      <button id="enter-main" style="background:linear-gradient(90deg,var(--brandA),var(--brandB)); color:#fff; border:0; padding:12px 16px; border-radius:14px; font-weight:800; box-shadow:0 10px 24px rgba(124,140,255,.36)">进入主页面</button>
    </div>
  </div>
</section>

<main class="wrap" id="app" aria-hidden="true">
  <header class="header">
    <h1 class="title">毛玻璃 · 音乐播放器示例</h1>
    <p class="sub">弹窗倒计时 + 底部音乐控制（显示封面/歌名/歌手/进度条）——可托管于 GitHub Pages。</p>
  </header>

  <section class="statusbar" aria-live="polite">
    <div style="display:flex;justify-content:center">
      <div class="pill"><span style="color:#4b5563">已持续</span>&nbsp;<b id="elapsed">00:00:00</b></div>
    </div>
    <div class="subnote"><svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M3 21l3.75-1 10.9-10.9a2.12 2.12 0 10-3-3L3.75 17l-0.75 4z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round"/><path d="M13 5l6 6" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg><div id="note-text">可在设置中修改起始时间与音乐文件</div></div>
  </section>

  <div class="visit-wrap"><a class="visit" href="https://www.jjjie.app" target="_blank" rel="noopener">访问主站</a></div>

  <section class="grid">
    <article class="card"><div class="card-head"><div class="card-title">第一部分 · 灵感设计</div><button class="unlock">解锁</button></div><div class="pw"><div style="display:flex;gap:8px"><input class="input" placeholder="示例密码：idea2025"><button class="ok">确认</button></div><div class="msg"></div></div><div class="content"><div class="content-inner"><h3>设计基因</h3><p>示例内容。</p></div></div></article>
    <article class="card"><div class="card-head"><div class="card-title">第二部分 · 色彩系统</div><button class="unlock">解锁</button></div><div class="pw"><div style="display:flex;gap:8px"><input class="input" placeholder="示例密码：tone2025"><button class="ok">确认</button></div><div class="msg"></div></div><div class="content"><div class="content-inner"><h3>渐变与层次</h3><p>示例内容。</p></div></div></article>
    <article class="card"><div class="card-head"><div class="card-title">第三部分 · 交互细节</div><button class="unlock">解锁</button></div><div class="pw"><div style="display:flex;gap:8px"><input class="input" placeholder="示例密码：flow2025"><button class="ok">确认</button></div><div class="msg"></div></div><div class="content"><div class="content-inner"><h3>动效与可达性</h3><p>示例内容。</p></div></div></article>
  </section>

  <footer class="footer">© 2025 Demo · 毛玻璃页面</footer>
</main>

<!-- Player (hidden until main shows) -->
<div class="player hidden" id="player">
  <div class="cover"><img id="cover-img" src="https://picsum.photos/seed/1/300/300" alt="cover" style="width:100%;height:100%;object-fit:cover"></div>
  <div class="meta">
    <div class="track" id="track-title">Track</div>
    <div class="artist" id="track-artist">Artist</div>
    <div class="progress">
      <input type="range" id="seek" min="0" max="100" value="0" step="0.1">
      <div class="time" id="time-cur">0:00</div>
      <div style="width:8px"></div>
      <div class="time" id="time-dur">0:00</div>
    </div>
  </div>
  <div class="controls">
    <button class="btn" id="prev">⟨</button>
    <button class="btn" id="play">▮▮</button>
    <button class="btn" id="next">⟩</button>
  </div>
</div>

<script>
// ====== Playlist (示例远程文件，可替换为 assets/music/*.mp3 和本地封面) ======
const playlist = [
  { title: "City Lights", artist: "Artificial.Music", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", cover: "https://picsum.photos/seed/11/300/300" },
  { title: "Memories", artist: "LiQWYD", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3", cover: "https://picsum.photos/seed/22/300/300" },
  { title: "Dreamscape", artist: "Tokyo Music Walker", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3", cover: "https://picsum.photos/seed/33/300/300" }
];

// ====== Elements ======
const mdBtn = document.getElementById('md-continue');
const modal = document.getElementById('modal');
const gate = document.getElementById('gate');
const enterBtn = document.getElementById('enter-main');
const app = document.getElementById('app');

const playerEl = document.getElementById('player');
const coverImg = document.getElementById('cover-img');
const titleEl = document.getElementById('track-title');
const artistEl = document.getElementById('track-artist');
const playBtn = document.getElementById('play');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const seek = document.getElementById('seek');
const timeCur = document.getElementById('time-cur');
const timeDur = document.getElementById('time-dur');

// ====== Audio state ======
let audio = new Audio();
audio.crossOrigin = "anonymous";
let idx = 0;
let isPlaying = false;
let seekDragging = false;
let raf = null;

// ====== Helper ======
function fmt(s){
  if (!isFinite(s)) return "0:00";
  s = Math.floor(s);
  const m = Math.floor(s/60);
  const sec = (s%60).toString().padStart(2,'0');
  return `${m}:${sec}`;
}
function loadTrack(i){
  const t = playlist[i];
  audio.src = t.src;
  coverImg.src = t.cover;
  titleEl.textContent = t.title;
  artistEl.textContent = t.artist;
  seek.value = 0;
  timeCur.textContent = "0:00";
  timeDur.textContent = "0:00";
}
function playTrack(){
  audio.play().then(()=>{ isPlaying=true; playBtn.textContent="▮▮"; startRAF(); }).catch((e)=>{ console.warn("play blocked", e); });
}
function pauseTrack(){ audio.pause(); isPlaying=false; playBtn.textContent="▶"; cancelRAF(); }
function startRAF(){
  cancelRAF();
  raf = requestAnimationFrame(updateProgress);
}
function cancelRAF(){ if(raf) cancelAnimationFrame(raf); raf = null; }

function updateProgress(){
  if(!seekDragging){
    if (audio.duration) {
      const pct = (audio.currentTime / audio.duration) * 100;
      seek.value = pct;
      timeCur.textContent = fmt(audio.currentTime);
      timeDur.textContent = fmt(audio.duration);
    }
  }
  raf = requestAnimationFrame(updateProgress);
}

// ====== Player controls ======
playBtn.addEventListener('click', ()=>{
  if(isPlaying) pauseTrack(); else playTrack();
});
prevBtn.addEventListener('click', ()=>{ idx = (idx-1+playlist.length)%playlist.length; loadTrack(idx); if(isPlaying) playTrack(); });
nextBtn.addEventListener('click', ()=>{ idx = (idx+1)%playlist.length; loadTrack(idx); if(isPlaying) playTrack(); });

seek.addEventListener('input', ()=>{ seekDragging = true; const pct = parseFloat(seek.value); if(audio.duration) timeCur.textContent = fmt((pct/100)*audio.duration); });
seek.addEventListener('change', ()=>{ if(audio.duration){ audio.currentTime = (parseFloat(seek.value)/100)*audio.duration; } seekDragging = false; });

// when track ends -> next
audio.addEventListener('ended', ()=>{ idx = (idx+1)%playlist.length; loadTrack(idx); playTrack(); });

// update duration metadata when available
audio.addEventListener('loadedmetadata', ()=>{ timeDur.textContent = fmt(audio.duration); });

// ====== Modal countdown (5s) ======
let countdown = 5;
mdBtn.disabled = true;
mdBtn.textContent = `我明白了 (${countdown})`;
const cd = setInterval(()=>{
  countdown--;
  if(countdown>0){
    mdBtn.textContent = `我明白了 (${countdown})`;
  }else{
    clearInterval(cd);
    mdBtn.disabled = false;
    mdBtn.textContent = `我明白了`;
    mdBtn.classList.add('active');
  }
}, 1000);

// ====== Flow: click mdBtn -> dismiss modal -> show gate. Then enter -> show main + player and start music ======
mdBtn.addEventListener('click', ()=>{
  // dismiss modal (slide up)
  modal.style.transition = 'transform .42s ease, opacity .42s ease';
  modal.style.transform = 'translateY(-24px) scale(.98)';
  modal.style.opacity = '0';
  setTimeout(()=>{ document.getElementById('modal').hidden = true; gate.removeAttribute('hidden'); }, 420);
});

enterBtn.addEventListener('click', ()=>{
  // gate envelope animation -> hide -> show main
  gate.classList.add('exit');
  gate.addEventListener('animationend', ()=>{
    gate.setAttribute('hidden','');
    app.setAttribute('aria-hidden','false');
    // show player and start music (user already interacted so playback allowed)
    playerEl.classList.remove('hidden');
    // init audio and start
    idx = 0; loadTrack(idx);
    playTrack();
    // scroll to top of main
    window.scrollTo({top:0, behavior:'smooth'});
  }, {once:true});
});

// ====== elapsed timer for statusbar (example start time) ======
(function(){
  const start = new Date("2020-01-01T00:00:00");
  const el = document.getElementById('elapsed');
  function pad(n){ return n.toString().padStart(2,'0') }
  function tick(){
    const now = new Date();
    let diff = Math.max(0, now - start);
    const d = Math.floor(diff / 86400000); diff -= d*86400000;
    const h = Math.floor(diff / 36e5); diff -= h*36e5;
    const m = Math.floor(diff / 6e4); diff -= m*6e4;
    const s = Math.floor(diff / 1e3);
    el.textContent = (d>0? d+"天 ":"")+`${pad(h)}:${pad(m)}:${pad(s)}`;
  }
  tick(); setInterval(tick, 1000);
})();

// ====== simple card unlock logic (reuse previous) ======
(function(){
  const PASSWORDS = { "card-1":"idea2025","card-2":"tone2025","card-3":"flow2025" };
  const cards = document.querySelectorAll('.card');
  function collapseAll(except){
    cards.forEach(c=>{ if(c!==except){ const pw = c.querySelector('.pw'); pw.style.display='none'; const content = c.querySelector('.content'); content.style.maxHeight = 0; }});
  }
  cards.forEach((card,i)=>{
    const unlock = card.querySelector('.unlock');
    const pw = card.querySelector('.pw');
    const input = card.querySelector('.input');
    const ok = card.querySelector('.ok');
    const msg = card.querySelector('.msg');
    unlock.addEventListener('click', ()=>{
      const show = pw.style.display==='block';
      collapseAll(card);
      pw.style.display = show? 'none':'block';
      if(!show) setTimeout(()=>input.focus(),50);
    });
    ok.addEventListener('click', ()=>{
      const val = input.value.trim();
      if(!val){ msg.textContent='请输入密码'; return; }
      // simple check by index
      if((i===0 && val==='idea2025') || (i===1 && val==='tone2025') || (i===2 && val==='flow2025')){
        msg.textContent='密码正确';
        const content = card.querySelector('.content');
        content.style.maxHeight = card.querySelector('.content-inner').scrollHeight + 'px';
        input.value='';
        setTimeout(()=>msg.textContent='',1200);
      }else{ msg.textContent='密码错误'; input.value=''; input.focus(); }
    });
  });
})();
</script>
</body>
</html>
